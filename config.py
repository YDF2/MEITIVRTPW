# -*- coding: utf-8 -*-
"""
全局配置文件
包含ALNS算法参数、权重系数、惩罚因子等
"""

# ================== 物理映射说明 ==================
# 假设 1 unit = 100 meters, 时间单位 = 分钟
# 因此 GRID_SIZE=100 表示 10km x 10km 的配送区域

# ================== 问题规模 ==================
NUM_ORDERS = 20          # 订单数量 (每个订单包含1个取货点+1个送货点)
NUM_VEHICLES = 5         # 每个站点的骑手数量
GRID_SIZE = 100          # 坐标范围 [0, GRID_SIZE]，即 10km x 10km 区域

# ================== 多站点配置 ==================
# 5个固定站点位置：四象限对称 + 中心
NUM_DEPOTS = 5
DEPOT_LOCATIONS = [
    (25, 25),   # 第三象限（左下）
    (75, 25),   # 第四象限（右下）
    (25, 75),   # 第二象限（左上）
    (75, 75),   # 第一象限（右上）
    (50, 50),   # 中心
]
VEHICLES_PER_DEPOT = NUM_VEHICLES  # 每个站点的骑手数量

# ================== 骑手参数 ==================
VEHICLE_CAPACITY = 6     # 骑手最大载重能力 (外卖场景通常3-6单)
# 电动车速度约 20-25km/h ≈ 333-416m/min ≈ 3.3-4.2 units/min
# 考虑红绿灯、起停、路阻等因素，取均速 20km/h
VEHICLE_SPEED = 3.3      # 骑手速度 (单位距离/单位时间)

# ================== 路阻系数 ==================
# 实际路网距离通常是曼哈顿距离的 1.2-1.4 倍 (绕路、红绿灯等)
DETOUR_FACTOR = 1.3

# ================== 时间窗参数 ==================
TIME_HORIZON = 300       # 时间跨度 (模拟午高峰 4小时 = 240分钟)
SERVICE_TIME_PICKUP = 12  # 取餐服务时间 (分钟)，含停车进店时间
SERVICE_TIME_DELIVERY = 30  # 送餐服务时间 (分钟)，含上楼等电梯时间
TIME_WINDOW_WIDTH =45   # 时间窗宽度 (分钟)

# ================== 目标函数权重 ==================
WEIGHT_DISTANCE = 1.0    # w1: 距离成本权重
# 迟到1分钟的惩罚相当于多跑 500米 (5 units)
WEIGHT_TIME_PENALTY = 10.0    # w2: 超时惩罚权重 (软时间窗)
WEIGHT_UNASSIGNED = 10000.0  # w3: 未分配订单惩罚权重 (绝对不允许甩单)
WEIGHT_VEHICLE_USAGE = 100.0 # w4: 骑手使用成本权重 (尽量少用骑手)

# ================== ALNS 算法参数 ==================
MAX_ITERATIONS = 1000    # 最大迭代次数
SEGMENT_SIZE = 100       # 权重更新的段大小（每100次迭代更新一次权重）

# 模拟退火参数
# 注意：初始温度会被自适应方法根据初始成本和问题规模覆盖
# 公式: T0 = -tau * initial_cost / ln(0.5)
# 目标：使初始接受差解的概率约为50%
INITIAL_TEMPERATURE = 1000.0  # 默认初始温度（备用）
COOLING_RATE = 0.9975         # 冷却系数（更慢降温=更多探索）
                              # 0.9975: 适合中大规模问题
                              # 0.995:  适合小规模问题
                              # 0.999:  超慢降温（大规模问题）
MIN_TEMPERATURE = 0.1         # 最低温度（不要设太低，避免完全无法接受差解）

# 破坏算子参数
DESTROY_RATE_MIN = 0.1   # 最小破坏比例（10%）
DESTROY_RATE_MAX = 0.4   # 最大破坏比例（40%）

# 空间邻近性参数（用于候选骑手筛选）
SPATIAL_FILTER_RATIO = 0.6  # 距离阈值 = GRID_SIZE * SPATIAL_FILTER_RATIO

# 算子权重更新参数（参考ALNS标准方法）
SIGMA_1 = 33  # 找到新的全局最优解（最高奖励）
SIGMA_2 = 9   # 找到比当前解更好的解（中等奖励）
SIGMA_3 = 13  # 接受了比当前解差的解（低奖励，鼓励探索）
DECAY_RATE = 0.2  # 权重衰减率（1-decay = 0.8为历史权重，decay = 0.2为当前得分）

# ================== 随机种子 ==================
RANDOM_SEED = 42

# ================== 文件路径 ==================
DATA_DIR = "data"
OUTPUT_DIR = "data/results"
