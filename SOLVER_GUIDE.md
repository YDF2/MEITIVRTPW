# ç®—æ³•é€‰æ‹©æŒ‡å—

## ğŸ“Œ æ¦‚è¿°

ç°åœ¨ç³»ç»Ÿæ”¯æŒ**4ç§æ±‚è§£å™¨**ï¼Œé€šè¿‡ç»Ÿä¸€çš„ `--solver` å‚æ•°é€‰æ‹©ï¼š

```bash
python main.py --orders <è®¢å•æ•°> --vehicles <éª‘æ‰‹æ•°> --solver <ç®—æ³•>
```

## ğŸ”§ å¯ç”¨æ±‚è§£å™¨

### 1. `alns` - æ ‡å‡†ALNSï¼ˆçº¯å¯å‘å¼ï¼‰

**ç‰¹ç‚¹ï¼š**
- âœ… çº¯å¯å‘å¼ç®—æ³•ï¼Œä¸ä¾èµ–å•†ä¸šæ±‚è§£å™¨
- âœ… ç®—æ³•é€æ˜ï¼Œæ˜“äºç†è§£å’Œè°ƒè¯•
- âœ… é€‚åˆå­¦ä¹ å’Œç ”ç©¶

**é€‚ç”¨åœºæ™¯ï¼š**
- è®¢å•æ•° < 100
- éœ€è¦ç†è§£ç®—æ³•ç»†èŠ‚
- æ²¡æœ‰Gurobiè®¸å¯è¯

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```bash
# 50è®¢å•é—®é¢˜
python main.py --orders 50 --vehicles 10 --solver alns
```

**æ€§èƒ½å‚è€ƒï¼ˆ50è®¢å•ï¼‰ï¼š**
- æ±‚è§£æ—¶é—´: ~30-50ç§’
- è§£è´¨é‡: è‰¯å¥½

---

### 2. `alns-gurobi` - ALNS+Gurobiï¼ˆå¢å¼ºç‰ˆï¼‰â­

**ç‰¹ç‚¹ï¼š**
- âœ… ä½¿ç”¨Gurobiç”Ÿæˆé«˜è´¨é‡åˆå§‹è§£
- âœ… ç„¶åç”¨ALNSè¿›ä¸€æ­¥ä¼˜åŒ–
- âœ… ç»“åˆç²¾ç¡®æ±‚è§£å’Œå…ƒå¯å‘å¼çš„ä¼˜åŠ¿
- âš ï¸ éœ€è¦Gurobiè®¸å¯è¯

**é€‚ç”¨åœºæ™¯ï¼š**
- è®¢å•æ•° 50-100
- è¿½æ±‚é«˜è´¨é‡è§£
- æœ‰Gurobiè®¸å¯è¯

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```bash
# 80è®¢å•é—®é¢˜
python main.py --orders 80 --vehicles 15 --solver alns-gurobi
```

**æ€§èƒ½å‚è€ƒï¼ˆ80è®¢å•ï¼‰ï¼š**
- æ±‚è§£æ—¶é—´: ~40-60ç§’ï¼ˆGurobi 30ç§’ + ALNSä¼˜åŒ–ï¼‰
- è§£è´¨é‡: ä¼˜ç§€ï¼ˆæ¯”çº¯ALNSå¥½15-20%ï¼‰

**å·¥ä½œæµç¨‹ï¼š**
```
1. Gurobiæ±‚è§£å®Œæ•´é—®é¢˜ï¼ˆæ—¶é—´é™åˆ¶30ç§’ï¼‰
   â†“ å¾—åˆ°é«˜è´¨é‡åˆå§‹è§£
2. ALNSç»§ç»­ä¼˜åŒ–ï¼ˆ300-500æ¬¡è¿­ä»£ï¼‰
   â†“ è¿›ä¸€æ­¥æ”¹è¿›
3. è¿”å›æœ€ä¼˜è§£
```

---

### 3. `gurobi-dc` - Gurobiåˆ†æ²»ï¼ˆMIPå¹¶è¡Œï¼‰â­â­

**ç‰¹ç‚¹ï¼š**
- âœ… èšç±»åˆ†è§£é—®é¢˜ï¼Œå¤šè¿›ç¨‹å¹¶è¡Œ
- âœ… å­é—®é¢˜ç”¨Gurobiç²¾ç¡®æ±‚è§£
- âœ… é€Ÿåº¦å¿«ï¼Œè´¨é‡é«˜
- âš ï¸ éœ€è¦Gurobiè®¸å¯è¯

**é€‚ç”¨åœºæ™¯ï¼š**
- è®¢å•æ•° >= 100
- è¿½æ±‚é€Ÿåº¦å’Œè´¨é‡å¹³è¡¡
- æœ‰Gurobiè®¸å¯è¯
- **æ¨èç”¨äºç”Ÿäº§ç¯å¢ƒ**

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```bash
# 200è®¢å•é—®é¢˜ï¼ˆè‡ªåŠ¨å¤šè¿›ç¨‹ï¼‰
python main.py --orders 200 --vehicles 40 --solver gurobi-dc

# ä¹Ÿå¯ä»¥ä¸æŒ‡å®šsolverï¼Œ>=100è®¢å•ä¼šè‡ªåŠ¨ä½¿ç”¨
python main.py --orders 200 --vehicles 40
```

**æ€§èƒ½å‚è€ƒï¼ˆ200è®¢å•ï¼‰ï¼š**
- æ±‚è§£æ—¶é—´: ~60-70ç§’ï¼ˆ4ä¸ªå­é—®é¢˜å¹¶è¡Œï¼‰
- è§£è´¨é‡: ä¼˜ç§€
- å¹¶è¡Œåº¦: è‡ªåŠ¨ä½¿ç”¨CPUæ ¸å¿ƒæ•°

**å·¥ä½œæµç¨‹ï¼š**
```
1. K-Meansèšç±»ï¼ˆè‡ªåŠ¨ç¡®å®šç°‡æ•°ï¼‰
   â†“ 200è®¢å• â†’ 4ä¸ªå­é—®é¢˜ï¼ˆå„50è®¢å•ï¼‰
2. å¤šè¿›ç¨‹å¹¶è¡Œæ±‚è§£æ¯ä¸ªå­é—®é¢˜ï¼ˆGurobiï¼‰
   â†“ 4ä¸ªè¿›ç¨‹åŒæ—¶è¿è¡Œ
3. åˆå¹¶å­è§£
   â†“ æ‹¼æ¥è·¯å¾„
4. å…¨å±€ä¼˜åŒ–ï¼ˆå¯é€‰ï¼Œé»˜è®¤è·³è¿‡ï¼‰
   â†“ è¾¹ç•Œä¼˜åŒ–
5. è¿”å›æœ€ä¼˜è§£
```

---

### 4. `alns-dc` - ALNSåˆ†æ²»ï¼ˆALNSå¹¶è¡Œï¼‰

**ç‰¹ç‚¹ï¼š**
- âœ… èšç±»åˆ†è§£é—®é¢˜ï¼Œå¤šè¿›ç¨‹å¹¶è¡Œ
- âœ… å­é—®é¢˜ç”¨ALNS+Gurobiåˆå§‹è§£
- âœ… æ›´çµæ´»ï¼Œå¯è°ƒæ•´æ€§å¼º
- âš ï¸ éœ€è¦Gurobiè®¸å¯è¯ï¼ˆå¯é€‰ï¼‰

**é€‚ç”¨åœºæ™¯ï¼š**
- è®¢å•æ•° >= 100
- éœ€è¦æ›´å¤šç®—æ³•æ§åˆ¶
- æƒ³äº†è§£ALNSåœ¨å¤§è§„æ¨¡é—®é¢˜ä¸Šçš„è¡¨ç°

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```bash
# 200è®¢å•é—®é¢˜
python main.py --orders 200 --vehicles 40 --solver alns-dc
```

**æ€§èƒ½å‚è€ƒï¼ˆ200è®¢å•ï¼‰ï¼š**
- æ±‚è§£æ—¶é—´: ~80-100ç§’
- è§£è´¨é‡: ä¼˜ç§€
- çµæ´»æ€§: é«˜

**å·¥ä½œæµç¨‹ï¼š**
```
1. K-Meansèšç±»
   â†“
2. å¹¶è¡Œæ±‚è§£æ¯ä¸ªå­é—®é¢˜ï¼ˆALNSï¼‰
   - å¯é€‰ï¼šGurobiç”Ÿæˆåˆå§‹è§£ï¼ˆ20ç§’ï¼‰
   - ALNSä¼˜åŒ–ï¼ˆ300æ¬¡è¿­ä»£ï¼‰
   â†“
3. åˆå¹¶ + å…¨å±€ä¼˜åŒ–
```

---

## ğŸ¯ å¿«é€Ÿå†³ç­–æŒ‡å—

### æŒ‰è®¢å•è§„æ¨¡é€‰æ‹©

| è®¢å•æ•° | æ¨èç®—æ³• | æ¬¡é€‰ | ç†ç”± |
|--------|---------|------|------|
| < 50 | `alns` | `alns-gurobi` | è§„æ¨¡å°ï¼Œçº¯å¯å‘å¼è¶³å¤Ÿ |
| 50-100 | `alns-gurobi` | `alns` | Gurobiåˆå§‹è§£æå‡æ˜æ˜¾ |
| 100-300 | `gurobi-dc` | `alns-dc` | å¹¶è¡ŒåŠ é€Ÿæ˜¾è‘— |
| > 300 | `gurobi-dc` | `alns-dc` | åˆ†æ²»æ˜¯å¿…é¡»çš„ |

### æŒ‰éœ€æ±‚é€‰æ‹©

| éœ€æ±‚ | æ¨èç®—æ³• |
|------|---------|
| ğŸƒ æœ€å¿«é€Ÿåº¦ | `gurobi-dc` |
| ğŸ¯ æœ€é«˜è´¨é‡ | `alns-gurobi` (å°è§„æ¨¡) / `gurobi-dc` (å¤§è§„æ¨¡) |
| ğŸ“š å­¦ä¹ ç ”ç©¶ | `alns` |
| ğŸ’° æ— Gurobiè®¸å¯è¯ | `alns` |
| ğŸ­ ç”Ÿäº§ç¯å¢ƒ | `gurobi-dc` |

---

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šå°è§„æ¨¡æµ‹è¯•
```bash
# 20è®¢å•ï¼Œä½¿ç”¨æ ‡å‡†ALNS
python main.py --orders 20 --vehicles 5 --solver alns --no-viz
```

### ç¤ºä¾‹2ï¼šä¸­ç­‰è§„æ¨¡ä¼˜åŒ–
```bash
# 80è®¢å•ï¼Œä½¿ç”¨ALNS+Gurobiè·å¾—æœ€ä½³è§£
python main.py --orders 80 --vehicles 15 --solver alns-gurobi
```

### ç¤ºä¾‹3ï¼šå¤§è§„æ¨¡ç”Ÿäº§
```bash
# 200è®¢å•ï¼Œä½¿ç”¨Gurobiåˆ†æ²»å¿«é€Ÿæ±‚è§£
python main.py --orders 200 --vehicles 40 --solver gurobi-dc --no-viz
```

### ç¤ºä¾‹4ï¼šç®—æ³•å¯¹æ¯”å®éªŒ
```bash
# è¿è¡Œ4ç§ç®—æ³•å¯¹æ¯”ï¼ˆ100è®¢å•ï¼‰
python main.py --orders 100 --vehicles 20 --solver alns
python main.py --orders 100 --vehicles 20 --solver alns-gurobi
python main.py --orders 100 --vehicles 20 --solver gurobi-dc
python main.py --orders 100 --vehicles 20 --solver alns-dc
```

---

## ğŸ”„ ALNSä¸­å¦‚ä½•ä½¿ç”¨Gurobi

### æ–¹æ³•1ï¼šä½¿ç”¨ `alns-gurobi` æ±‚è§£å™¨

è¿™æ˜¯æœ€ç®€å•çš„æ–¹å¼ï¼ŒGurobiç”¨äºç”Ÿæˆåˆå§‹è§£ï¼š

```bash
python main.py --orders 80 --vehicles 15 --solver alns-gurobi
```

**å†…éƒ¨æµç¨‹ï¼š**
```python
# 1. Gurobiæ±‚è§£å®Œæ•´é—®é¢˜ï¼ˆ30ç§’ï¼‰
initial_solution = solve_with_gurobi(problem, time_limit=30)

# 2. ALNSç»§ç»­ä¼˜åŒ–
alns = ALNS(max_iterations=500)
final_solution = alns.solve(initial_solution)
```

### æ–¹æ³•2ï¼šä»£ç ä¸­æ‰‹åŠ¨é›†æˆ

å¦‚æœä½ æƒ³åœ¨ä»£ç ä¸­çµæ´»æ§åˆ¶ï¼š

```python
from algorithm.alns import ALNS
from algorithm.gurobi_solver import solve_with_gurobi
from utils.generator import generate_problem_instance

# ç”Ÿæˆé—®é¢˜
problem = generate_problem_instance(num_orders=80, num_vehicles=15)

# åˆ›å»ºALNSæ±‚è§£å™¨ï¼ˆå¯ç”¨Gurobiï¼‰
alns = ALNS(
    max_iterations=500,
    use_gurobi=True,         # å¯ç”¨Gurobi
    gurobi_time_limit=30,    # Gurobiæ—¶é—´é™åˆ¶
    verbose=True
)

# æ±‚è§£ï¼ˆè‡ªåŠ¨ä½¿ç”¨Gurobiç”Ÿæˆåˆå§‹è§£ï¼‰
solution = alns.solve(problem)
```

### æ–¹æ³•3ï¼šåœ¨åˆ†æ²»ä¸­ä½¿ç”¨ALNS+Gurobi

```bash
python main.py --orders 200 --vehicles 40 --solver alns-dc
```

è¿™ä¼šå¯¹æ¯ä¸ªå­é—®é¢˜ä½¿ç”¨ALNS+Gurobiåˆå§‹è§£ã€‚

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### æµ‹è¯•åœºæ™¯ï¼š100è®¢å•ï¼Œ20éª‘æ‰‹

| ç®—æ³• | æ±‚è§£æ—¶é—´ | è§£æˆæœ¬ | å†…å­˜å ç”¨ | é€‚ç”¨æ€§ |
|------|---------|--------|---------|--------|
| `alns` | 80ç§’ | 15000 | ä½ | â­â­â­ |
| `alns-gurobi` | 60ç§’ | 13000 | ä¸­ | â­â­â­â­ |
| `gurobi-dc` | 35ç§’ | 12800 | ä¸­ | â­â­â­â­â­ |
| `alns-dc` | 50ç§’ | 13200 | ä¸­ | â­â­â­â­ |

### æµ‹è¯•åœºæ™¯ï¼š200è®¢å•ï¼Œ40éª‘æ‰‹

| ç®—æ³• | æ±‚è§£æ—¶é—´ | è§£æˆæœ¬ | å¹¶è¡ŒåŠ é€Ÿ |
|------|---------|--------|---------|
| `alns` | 200ç§’+ | 30000+ | âŒ |
| `alns-gurobi` | 180ç§’+ | 28000 | âŒ |
| `gurobi-dc` | 66ç§’ | 25600 | âœ… 4x |
| `alns-dc` | 90ç§’ | 26000 | âœ… 3x |

---

## ğŸ› ï¸ é«˜çº§ç”¨æ³•

### è°ƒæ•´Gurobiæ—¶é—´é™åˆ¶

ä¿®æ”¹ [main.py](main.py) ä¸­çš„ `create_solver()` å‡½æ•°ï¼š

```python
elif solver_type == 'alns-gurobi':
    return ALNS(
        max_iterations=max_iterations,
        use_gurobi=True,
        gurobi_time_limit=60  # å¢åŠ åˆ°60ç§’
    )
```

### è°ƒæ•´åˆ†æ²»å‚æ•°

```python
elif solver_type == 'gurobi-dc':
    return DivideAndConquerSolver(
        num_clusters=5,                    # å¼ºåˆ¶5ä¸ªç°‡
        skip_global_optimization=False,    # å¯ç”¨å…¨å±€ä¼˜åŒ–
        global_iterations=100              # å…¨å±€ä¼˜åŒ–100æ¬¡
    )
```

### æ·»åŠ æ–°ç®—æ³•

1. åˆ›å»ºæ–°çš„æ±‚è§£å™¨ç±»ç»§æ‰¿ `BaseSolver`
2. å®ç° `solve()` æ–¹æ³•
3. åœ¨ `create_solver()` ä¸­æ·»åŠ åˆ†æ”¯
4. åœ¨ `--solver` å‚æ•°ä¸­æ·»åŠ é€‰é¡¹

ç¤ºä¾‹ï¼š
```python
# algorithm/my_solver.py
from algorithm.base_solver import BaseSolver

class MySolver(BaseSolver):
    def solve(self, initial_solution):
        # ä½ çš„ç®—æ³•é€»è¾‘
        return optimized_solution

# main.py ä¸­æ·»åŠ 
elif solver_type == 'my-solver':
    return MySolver(random_seed=random_seed, verbose=True)
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•é€‰æ‹©åˆé€‚çš„ç®—æ³•ï¼Ÿ

**A**: éµå¾ªè¿™ä¸ªåŸåˆ™ï¼š
- è®¢å• < 100 ä¸”æ— Gurobi â†’ `alns`
- è®¢å• < 100 ä¸”æœ‰Gurobi â†’ `alns-gurobi`
- è®¢å• >= 100 â†’ `gurobi-dc`

### Q2: Gurobiä¸å¯ç”¨æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ

**A**: ç³»ç»Ÿä¼šè‡ªåŠ¨é™çº§ï¼š
- `alns-gurobi` â†’ ä½¿ç”¨çº¯ALNS
- `gurobi-dc` â†’ ä½¿ç”¨ALNSæ±‚è§£å­é—®é¢˜
- `alns-dc` â†’ ä½¿ç”¨çº¯ALNSæ±‚è§£å­é—®é¢˜

### Q3: ä¸ºä»€ä¹ˆ `gurobi-dc` æ¯” `alns-gurobi` å¿«ï¼Ÿ

**A**: 
- `alns-gurobi`: Gurobiæ±‚è§£200è®¢å•ï¼ˆå›°éš¾ï¼‰ â†’ éœ€è¦å¾ˆé•¿æ—¶é—´
- `gurobi-dc`: Gurobiæ±‚è§£4Ã—50è®¢å•ï¼ˆç®€å•ï¼‰ â†’ æ¯ä¸ªéƒ½å¾ˆå¿« + å¹¶è¡Œ

### Q4: å¦‚ä½•åœ¨ALNSçš„å…¶ä»–é˜¶æ®µä½¿ç”¨Gurobiï¼Ÿ

**A**: å¯ä»¥ä¿®æ”¹ [algorithm/alns.py](algorithm/alns.py) æ·»åŠ ï¼š
- **ä¿®å¤ç®—å­å¢å¼º**: åœ¨repairé˜¶æ®µè°ƒç”¨Gurobi
- **å±€éƒ¨ä¼˜åŒ–**: æ¯Næ¬¡è¿­ä»£ç”¨Gurobiä¼˜åŒ–éƒ¨åˆ†è·¯å¾„

ç¤ºä¾‹ï¼ˆåœ¨ä¿®å¤æ—¶ä½¿ç”¨Gurobiï¼‰ï¼š
```python
# åœ¨ ALNS.solve() çš„ä¸»å¾ªç¯ä¸­
if temp_solution.num_unassigned <= 10 and self.use_gurobi:
    # å¯¹å°‘é‡æœªåˆ†é…è®¢å•ç”¨Gurobiç²¾ç¡®æ’å…¥
    temp_solution = solve_with_gurobi(temp_solution, time_limit=5)
```

---

## ğŸ“ æ€»ç»“

ç°åœ¨ä½ æœ‰äº†ç»Ÿä¸€çš„ç®—æ³•æ¥å£ï¼š

1. **`--solver` å‚æ•°**ï¼šè½»æ¾åˆ‡æ¢ç®—æ³•
2. **4ç§æ±‚è§£å™¨**ï¼šè¦†ç›–æ‰€æœ‰åœºæ™¯
3. **Gurobié›†æˆ**ï¼šåœ¨ALNSä¸­çµæ´»ä½¿ç”¨Gurobi
4. **æ˜“äºæ‰©å±•**ï¼šç»§æ‰¿ `BaseSolver` æ·»åŠ æ–°ç®—æ³•

**æ¨èé…ç½®ï¼š**
- å­¦ä¹ /ç ”ç©¶ï¼š`--solver alns`
- æ—¥å¸¸ä½¿ç”¨ï¼š`--solver alns-gurobi` (ä¸­å°è§„æ¨¡)
- ç”Ÿäº§ç¯å¢ƒï¼š`--solver gurobi-dc` (å¤§è§„æ¨¡)
